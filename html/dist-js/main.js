var st=navigator.language??"en",l={websocket_url:"wss://ws.eddn-realtime.space/eddn",idleTimeout:2300,resetTimeout:300*1e3,oldAge:3600*1e3,newAge:180*-1e3,templateLocale:"en",numberLocale:st,timeLocale:st,timeOptions:{style:"narrow"}};l.v=new Intl.NumberFormat(l.numberLocale,l.numberOptions);l.E=new Intl.RelativeTimeFormat(l.timeLocale,l.timeOptions);Object.freeze(l);var C=[null,"Galactic Centre","Empyrean Straits","Ryker's Hope","Odin's Hold","Norma Arm","Arcadian Stream","Izanami","Inner Orion-Perseus Conflux","Inner Scutum-Centaurus Arm","Norma Expanse","Trojan Belt","The Veils","Newton's Vault","The Conduit","Outer Orion-Perseus Conflux","Orion-Cygnus Arm","Temple","Inner Orion Spur","Hawking's Gap","Dryman's Point","Sagittarius-Carina Arm","Mare Somnia","Acheron","Formorian Frontier","Hieronymus Delta","Outer Scutum-Centaurus Arm","Outer Arm","Aquila's Halo","Errant Marches","Perseus Arm","Formidine Rift","Vulcan Gate","Elysian Shore","Sanguineous Rim","Outer Orion Spur","Achilles's Altar","Xibalba","Lyra's Song","Tenebrae","The Abyss","Kepler's Crest","The Void"];var R=-49985,ot=-40985,F=-24105,y=2048,rt=83/4096,E,w,I=!1,Mt=(async function(){try{let n="./data/RegionMapData.bin";console.debug("RegionMap: loading data...");let t=await fetch(n);if(!t.ok)throw new Error(`HTTP ${t.status} ${t.statusText}`);let e=await t.arrayBuffer(),s=y+1,r=s*4;if(!(new Uint8Array(new Uint32Array([305419896]).buffer)[0]===120)){console.debug("RegionMap: converting byte-order");let i=new DataView(e);for(let a=0;a<r;a+=4)i.setUint32(a,i.getUint32(a,!0));for(let a=r;a<e.byteLength;a+=2)i.setUint16(a,i.getUint16(a,!0))}if(E=new Uint32Array(e,0,s),w=new Uint16Array(e,r),w.length!==E[y])throw new Error(`Data length mismatch: Got ${w.length}, expected ${E[y]}`);I=!0,console.debug(`RegionMap: load done - ${y} rows, ${w.length/2} segments`)}catch(n){console.error("RegionMap: initialization failed:",n)}})(),m=(n,t,e=0n)=>n>>e&~(~0n<<t),T=class{static get ready(){return Mt}static get isReady(){return I}static get X0(){return R}static get Y0(){return ot}static get Z0(){return F}static findRegion(t,e,s){if(!I||t===void 0||s===void 0)return{id:0,name:null};let r=Math.floor((t-R)*rt),o=Math.floor((s-F)*rt);if(r<0||r>=y||o<0||o>=y)return{id:0,name:null};let i=E[o],a=E[o+1]-1,h=r;for(let u=i;u<a;u+=2){let p=w[u];if(h<p){let b=w[u+1];return{id:b,name:C[b]}}h-=p}return{id:0,name:null}}static findRegionForId64(t){let{BoxelPos:e}=this.decodeId64(t);return this.findRegion(...e)}static sectorsToCoords(t,e,s,r=0,o=0,i=0,a=0){let h=((t<<7)+(o<<r))*10+R,u=((e<<7)+(i<<r))*10+ot,p=((s<<7)+(a<<r))*10+F;return{x:h,y:u,z:p}}static decodeId64(t){let e=BigInt(t),s=m(e,55n),r=Number(e>>55n),o=Number(m(e,3n)),i=BigInt(7-o),a=3n,h=Number(m(e,i,a));a+=i;let u=Number(m(e,7n,a));a+=7n;let p=Number(m(e,i,a));a+=i;let b=Number(m(e,6n,a));a+=6n;let tt=Number(m(e,i,a));a+=i;let et=Number(m(e,7n,a));a+=7n;let Tt=Number(m(e,32n-i*3n,a)),{x:vt,y:Dt,z:Nt}=this.sectorsToCoords(et,b,u,o,tt,p,h);return{SystemAddress:s,BoxelPos:[vt,Dt,Nt],BodyId:r,massClass:o,xs:et,ys:b,zs:u,xb:tt,yb:p,zb:h,n2:Tt}}static procSystemName(t,e,s,r,o){let i=e|s<<7|r<<14,a=String.fromCharCode(i%26+65);i=~~(i/26);let h=String.fromCharCode(i%26+65);i=~~(i/26);let u=String.fromCharCode(i%26+65);return i=~~(i/26),`${a}${h}-${u} ${String.fromCharCode(t+97)}${i?`${i}-${o}`:o}`}};var v=class n extends Event{$schemaRef;header;message;data;#e;#s=0;#t=!1;#o;#r;#n;#i;#a;#u;#h;#d=!1;#m;constructor(t,e){super(t),{$schemaRef:this.$schemaRef,header:this.header,message:this.message}=this.data=e,this.#e=Date.now()}get receiveTimestamp(){return new Date(this.#e)}get age(){return this.#t?this.#s:(this.#t=!0,this.#s=Date.parse(this.header?.gatewayTimestamp)-Date.parse(this.message?.timestamp))}get eventType(){return this.#o??=n.getEventType(this.data)}get eventName(){return this.#r??=this.message?.event??this.eventType}get gameType(){return this.#n??=n.getGameType(this.data)}get isTaxi(){return this.#i??=!!this.message?.Taxi}get isMulticrew(){return this.#a??=!!this.message?.Multicrew}get StarSystem(){return this.#u??=this.message?.StarSystem??this.message?.systemName??this.message?.SystemName??this.message?.System??this.message?.Route?.[0]?.StarSystem??""}get StarPos(){return this.#d?this.#h:(this.#d=!0,this.#h=this.message?.StarPos??this.message?.Route?.[0]?.StarPos)}get Region(){return this.#m??=this.StarPos?T.findRegion(...this.StarPos):{}}static getEventType(t){if(!t?.$schemaRef)return"";let e=t.$schemaRef.match(At)?.[1]??"";return e==="journal"&&t.message?.event&&(e=`journal:${t.message.event.toLowerCase()}`),e}static getGameType(t){try{let e=t.header.gameversion;if(e&&(e.startsWith("CAPI-Legacy-")||parseInt(e)<4))return"Legacy";let s=t.message;return s.odyssey?"Odyssey":s.horizons?"Horizons":s.horizons===!1?"Base":"Unknown"}catch(e){return console.error("gameversion error:",e),"Unknown"}}},At=/\/schemas\/([^/]+)\/(\d+)(\/test)?$/;var D=class extends EventTarget{#e;#s=null;#t=null;#o=null;#r=null;#n=null;#i=()=>!0;#a=[];url="ws://127.0.0.1:8081";resetTimeout=0;constructor(t={}){super();let{url:e,resetTimeout:s,filter:r,WebSocketClass:o,signal:i}=t;if(this.url=e??this.url,this.#e=o??WebSocket,s){if(!Number.isInteger(s))throw new Error("resetTimeout must be an integer");this.resetTimeout=s}if(r){if(typeof r!="function")throw new Error("filter must be a function");this.#i=r}i?.addEventListener("abort",()=>this.close(),{once:!0})}connect(){this.#o&&this.close(),console.debug("EDDNClient: connecting"),this.#s=new AbortController;let t=this.#s.signal;this.#o=new this.#e(this.url,this.#a,{signal:t}),this.#o.binaryType="arraybuffer",this.#p(this.#o,t)}close(){console.debug("EDDNClient: closing"),this.#c(),this.#s?.abort(),this.#s=null,this.#o?.close(),this.#o=null,console.log("EDDNClient: WebSocket removed"),this.dispatchEvent(new CloseEvent("close",{code:1e3,reason:"EDDNClient.close() called",wasClean:!0}))}#u(t){if(this.#o!==t.target){console.warn("EDDNClient: spurious `message` from unknown socket:",t);return}let e=t.data,s;try{if(typeof e=="string")s=JSON.parse(e);else if(e instanceof ArrayBuffer)s=JSON.parse((this.#t??=new TextDecoder("utf-8")).decode(e));else throw new Error(`Unexpected message format (${typeof e})`)}catch(r){this.dispatchEvent(new ErrorEvent("eddn:error",{message:"Message parse error",error:r}));return}this.#h(s)}#h(t){let e;try{let{$schemaRef:s,header:r,message:o}=t;if(!s||!r||!o)throw new Error("Missing required properties");if(e=new v("eddn:message",{$schemaRef:s,header:r,message:o}),!e.eventType)throw new Error("Unknown event type")}catch(s){this.dispatchEvent(new ErrorEvent("eddn:error",{message:"Message content error",error:s}));return}this.#r=Date.now(),this.#i(e)&&this.dispatchEvent(e)}#d(t){if(this.#o!==t.target){console.warn("EDDNClient: spurious `open` from unknown socket:",t);return}console.log(`EDDNClient: WebSocket connected${this.#o.protocol?` with protocol '${this.#o.protocol}'`:""}`),this.#c(),this.#l(),this.#r=Date.now(),this.dispatchEvent(new Event("open"))}#m(t){if(this.#o!==t.target){console.warn("EDDNClient: spurious `close` from unknown socket:",t);return}console.log("EDDNClient: WebSocket closed"),this.#c(),typeof this.#o.reconnect!="function"&&(this.#o=null),this.dispatchEvent(new CloseEvent("close",{code:t.code,reason:t.reason,wasClean:t.wasClean}))}#f(t){if(this.#o!==t.target){console.warn("EDDNClient: spurious `error` from unknown socket:",t);return}console.warn("EDDNClient: WebSocket error received"),this.dispatchEvent(new Event("error"))}#p(t,e){t.addEventListener("open",s=>this.#d(s),{signal:e}),t.addEventListener("close",s=>this.#m(s),{signal:e}),t.addEventListener("error",s=>this.#f(s),{signal:e}),t.addEventListener("message",s=>this.#u(s),{signal:e})}#l(){if(!this.#o||this.resetTimeout<=0)return;if(this.#r&&this.#o.readyState===this.#e.OPEN&&Date.now()-this.#r>this.resetTimeout){console.log("EDDNClient: Receive timeout. Resetting connection."),typeof this.#o.reconnect=="function"?this.#o.reconnect():this.connect();return}let t=~~(6e4+Math.random()*42e3);this.#n=setTimeout(()=>this.#l(),t)}#c(){clearTimeout(this.#n),this.#n=null,this.#r=null}};var N=class{#e=new Map;#s=new Set;constructor(t,e={}){let{signal:s}=e;s?.addEventListener("abort",()=>{this.#e=this.#s=null},{once:!0}),t.addEventListener("eddn:message",r=>this.#t(r),{signal:s})}register(t,e,s={}){let{signal:r}=s;if(!e){this.#s.has(t)||(this.#s.add(t),r?.addEventListener("abort",()=>this.unregister(t,["*"]),{once:!0}));return}if(typeof e=="string")e=[e];else if(typeof e[Symbol.iterator]!="function")throw new TypeError("topics must be iterable");e=Array.from(e),r?.addEventListener("abort",()=>this.unregister(t,e),{once:!0});for(let o of e){if(o==="*"){this.#s.add(t);continue}let i=this.#e.get(o);i||(i=new Set,this.#e.set(o,i)),i.add(t)}}unregister(t,e){if(!e){this.unregisterAll(t);return}if(typeof e=="string")e=[e];else if(typeof e[Symbol.iterator]!="function")throw new TypeError("topics must be iterable");for(let s of e){if(s==="*"){this.#s.delete(t);continue}let r=this.#e.get(s);r&&(r.delete(t),r.size===0&&this.#e.delete(s))}}unregisterAll(t){this.#s.delete(t);for(let[e,s]of this.#e)s.delete(t),s.size===0&&this.#e.delete(e)}#t(t){if(this.#s.size>0)for(let s of this.#s)nt(s,t);let e=this.#e.get(t.eventType);if(e)for(let s of e)nt(s,t)}};function nt(n,t){try{n(t)}catch(e){console.error("MessageRouter: Error in message handler:",e)}}var L=class n{#e;#s;constructor(t,e){this.#e=t,this.#s=e}show(t){if(!t)return;let e=JSON.stringify(t,null,2),s=document.importNode(this.#s.content,!0).firstElementChild,r={"copy-msg":o=>n.#t(e,o),"copy-gts":o=>n.#t(t.header?.gatewayTimestamp,o),"copy-uid":o=>n.#t(t.header?.uploaderID,o),close:()=>s.remove()};s.querySelector(".infobox__content").textContent=e,s.querySelector(".infobox__header").addEventListener("click",o=>{o.stopPropagation();let i=o.target.closest(".infobox__header [data-infobox__action]"),a=i?.dataset.infobox__action??"close";r[a]?.(i)}),this.#e.append(s)}static#t(t,e){return navigator.clipboard?navigator.clipboard.writeText(t).then(()=>n.#o(e,"infobox__button--signal-success")).catch(s=>(console.warn("InfoBox: clipboard copy error:",s),n.#o(e,"infobox__button--signal-error"))):(console.warn("InfoBox: clipboard API unavailable"),n.#o(e,"infobox__button--signal-error"))}static#o(t,e){return new Promise(s=>{t.classList.remove(e),t.offsetWidth,t.addEventListener("animationend",()=>{t.classList.remove(e),s()},{once:!0}),t.classList.add(e)})}};var P=class{constructor(t,e){if(t){if(!e)throw new Error("DashboardModule: missing required arguments");t.register(s=>this.e(s),e)}}e(t){}},c=class n extends P{static DATA_KEY=Symbol();#e=[];#s=!1;c;w;b;S;listLength=l.listLength??20;cullFactor=2;constructor(t,e,s={}){let{listLength:r,cullFactor:o,template:i}=s;if(r&&!Number.isInteger(r))throw new Error("listLength must be an integer");if(o&&isNaN(parseFloat(o)))throw new Error("cullFactor must be a number");super(t,e),r&&(this.listLength=r),o&&(this.cullFactor=parseFloat(o)),this.w=i,this.D()}n(){if(!this.w)return null;let t=document.importNode(this.w.content,!0),e=t.querySelector("tbody");return!e.childElementCount&&this.listLength&&(e.innerHTML="<tr><td>&nbsp;</td></tr>".repeat(this.listLength)),this.c=e,t}D(){this.b=document.createElement("tr"),this.b.classList.add("data"),this.S=document.createElement("td")}u(t){let e=this.S.cloneNode(!1);return e.textContent=e.title=t??"",e}N(t){let e=this.b.cloneNode(!1);return e.classList.add(t.gameType),t.isTaxi&&e.classList.add("taxi"),t.isMulticrew&&e.classList.add("multicrew"),t.age>l.oldAge?e.classList.add("old"):t.age<l.newAge&&e.classList.add("new"),e}o(t){this.#e.push(t),this.#o(this.listLength,this.listLength*this.cullFactor),!this.#s&&this.#e.length&&(this.#s=!0,requestAnimationFrame(()=>this.#t()))}#t(){let t=this.#e,e=this.c;if(this.#s=!1,!t.length){console.warn("DataTableModule: render scheduled on empty queue");return}this.#o(this.listLength)&&e.replaceChildren();let s=e.childElementCount+t.length-this.listLength,r=document.createDocumentFragment();for(let{event:o,cells:i}of t){if(!o||!Array.isArray(i)){console.warn("DataTableModule: missing or invalid properties in render queue item");continue}let a=this.N(o);for(let h of i)a.append(h instanceof Node?h:typeof h=="function"?$t(h)??this.u():this.u(h));a[n.DATA_KEY]=o.data,r.prepend(a)}if(t.length=0,s>0)for(let o=0;o<s;o++)e.lastElementChild?.remove();e.prepend(r)}#o(t,e){let s=this.#e,r=s.length;if(r>(e??t)){let o=r-t;return s.copyWithin(0,o),s.length=t,o}return 0}},M=class extends c{constructor(t,e){super(null,null,e)}};function $t(n){try{return n()}catch(t){console.error("DataTableModule: Error in cell callback:",t);return}}var _=class extends c{constructor(t,e){super(t,["approachsettlement"],e)}e(t){this.o({event:t,cells:[t.message.Name,t.StarSystem]})}},it=_;var k=class extends c{constructor(t,e){super(t,["codexentry"],e)}e(t){let e=t.message;this.o({event:t,cells:[e.System,It(e.BodyName??"",e.System),at(e.SubCategory,Ot),at(e.Name,Rt),C[+(Ft.exec(e.Region)?.[1]??0)]]})}},Ot=/^\$Codex_SubCategory_(.*);$/,Rt=/^\$Codex_Ent_(.*)_Name;$/,Ft=/^\$Codex_RegionName_(.*);$/,at=(n,t)=>t.exec(n)?.[1]?.replaceAll("_"," ")??n,It=(n,t)=>(n.startsWith(t)?n.slice(t.length):n).trim(),ct=k;var B=class extends c{constructor(t,e){super(t,["*"],e)}e(t){this.o({event:t,cells:[kt(t.age),()=>this.#e(t.header.uploaderID),t.eventName,t.header.softwareName,t.header.softwareVersion,t.StarSystem,t.Region.name,`${t.header.gameversion??""}${t.header.gamebuild?` - ${t.header.gamebuild}`:""}`,t.$schemaRef.replace(Pt,"")]})}#e(t){let e=this.u(t);return e.classList.add("dashboard__table--idcell"),e.replaceChildren(jt(t)),e}},Pt=/^https:\/\/eddn\.edcd\.io\/schemas\//,_t=Object.freeze([{unit:"year",seconds:31536e3},{unit:"month",seconds:2592e3},{unit:"day",seconds:86400},{unit:"hour",seconds:3600},{unit:"minute",seconds:60}]);function kt(n){try{let t=Math.round(-n/1e3),e=Math.abs(t);if(e<60)return l.E.format(t,"second");for(let{unit:s,seconds:r}of _t)if(e>=r||s==="minute"){let o=Math.round(t/r);return l.E.format(o,s)}}catch(t){return console.error(t.message),"Invalid date"}}var Bt=Object.freeze({0:"#F2F3F4",1:"#222222",2:"#F3C300",3:"#875692",4:"#F38400",5:"#A1CAF1",6:"#BE0032",7:"#C2B280",8:"#848482",9:"#008856",a:"#E68FAC",b:"#0067A5",c:"#F99379",d:"#604E97",e:"#DCD300",f:"#B3446C",A:"#E68FAC",B:"#0067A5",C:"#F99379",D:"#604E97",E:"#DCD300",F:"#B3446C"});function jt(n){let t=n.length,e=100/t,s=[];for(let o=0;o<t;o++){let i=Bt[n[o]]??"#000";s.push(`${i} ${o*e}% ${(o+1)*e}%`)}let r=document.createElement("span");return r.style.background=`linear-gradient(to right, ${s.join(",")})`,r.textContent="\xA0",r}var lt=B;var Wt=(...n)=>{let t=document.createElement("tr");return t.append(...n),t},Ut=n=>{let t=document.createElement("td");return t.textContent=n??"",t},j=class{#e=0;C;#s;m;constructor(t,e,s,r){let o=r(t),i=r();this.#s=i,this.C=t,this.i=e,this.m=s(o,i)}set i(t){this.#s.textContent=this.#e=t}get i(){return this.#e}},g=class{a=new Map;r=[];#e;#s=t=>Ut(t);#t=(...t)=>Wt(...t);constructor(t,e={}){t.replaceChildren(),this.#e=t;let{values:s,rowFactory:r,cellFactory:o}=e;this.#t=r??this.#t,this.#s=o??this.#s;for(let i in s)this.set(i,s[i])}has(t){return this.a.has(t)}set(t,e){if(this.has(t))this.r[this.a.get(t)].i=e;else{let s=new j(t,e,this.#t,this.#s);this.a.set(t,this.r.length),this.r.push(s),this.#e.append(s.m)}}inc(t){this.has(t)?this.r[this.a.get(t)].i++:this.set(t,1)}},A=class extends g{set(t,e){super.set(t,e),this.T(t)}inc(t){super.inc(t),this.T(t)}T(t){let e=this.a.get(t);if(e===void 0||e<=0)return;let s=this.r[e],r=s.i,o=e-1;if(r<=this.r[o].i)return;for(;o>0&&r>this.r[o-1].i;)o--;let i=this.r[o].m;this.r.copyWithin(o+1,o,e),this.r[o]=s,this.a.set(t,o);for(let a=o+1;a<=e;a++)this.a.set(this.r[a].C,a);i.before(s.m)}};var W=class extends c{s;constructor(t,e){super(t,["*"],e)}n(){let t=super.n();return this.s=new A(this.c),t}e(t){this.s.inc(t.eventName)}},ht=W;var U=class extends c{constructor(t,e){super(t,["journal:fsdjump"],e)}e(t){this.o({event:t,cells:[t.StarSystem]})}},dt=U;var z=class extends c{s;constructor(t,e){super(t,["*"],e)}n(){let t=super.n();return this.s=new g(this.c,{values:{Total:0,Odyssey:0,Horizons:0,Base:0,Legacy:0,Unknown:0,Taxi:0,Multicrew:0,Old:0,New:0}}),t}e(t){this.s.inc("Total"),this.s.inc(t.gameType),t.isTaxi&&this.s.inc("Taxi"),t.isMulticrew&&this.s.inc("Multicrew"),t.age>l.oldAge?this.s.inc("Old"):t.age<l.newAge&&this.s.inc("New")}},ut=z;var G=class extends c{constructor(t,e){super(t,["journal:location","journal:docked"],e)}e(t){let e=t.message;this.o({event:t,cells:[e.StationName,e.StationType,t.StarSystem]})}},mt=G;var H=class extends c{constructor(t,e){super(t,["navroute"],e)}e(t){let e=t.message.Route??[];if(e.length<2)return;let s=0,r=0,o=[];if(o.push(e[0].StarSystem,e[e.length-1].StarSystem,`${e.length-1}j`),e.length===2)s=r=q(e[0].StarPos,e[1].StarPos),o.push(`${s.toFixed(2)}ly`,"");else{let i;for(let a of e){if(!i){i=a.StarPos,o.push(`${q(i,e[e.length-1].StarPos).toFixed(2)}ly`);continue}let h=a.StarPos,u=q(i,h);r<u&&(r=u),s+=u,i=h}o.push(`${s.toFixed(2)}ly`)}if(r<200)o.push(`${r.toFixed(2)}ly`);else{let i=this.u(`${r.toFixed(2)}ly`);i.classList.add("longjump"),o.push(i)}this.o({event:t,cells:o})}},q=(n,t)=>Math.hypot(n[0]-t[0],n[1]-t[1],n[2]-t[2]),ft=H;var X=class extends c{constructor(t,e){super(t,["journal:scan"],e)}e(t){let e=t.message;e.WasDiscovered===!1&&e.WasMapped===!1&&e.ScanType!=="NavBeaconDetail"&&e.PlanetClass&&this.o({event:t,cells:[e.BodyName,e.PlanetClass,e.AtmosphereType&&e.AtmosphereType!=="None"?e.AtmosphereType:"",e.Landable?"Yes":""]})}},pt=X;var V=class extends c{constructor(t,e){super(t,["journal:scan"],e)}e(t){let e=t.message;e.WasDiscovered===!1&&e.WasMapped===!1&&e.ScanType!=="NavBeaconDetail"&&e.StarType&&this.o({event:t,cells:[e.BodyName,`${e.StarType} ${e.Subclass}`]})}},gt=V;var Y=class extends c{s;constructor(t,e){super(t,["*"],e)}n(){let t=super.n();return this.s=new g(this.c),t}e(t){let e=t.header,s=`${e.softwareName} ${e.softwareVersion}`,r=!this.s.has(s);if(this.s.inc(s),r){let o=this.c;o.replaceChildren(...[...o.children].sort((i,a)=>a.children[0].textContent.localeCompare(i.children[0].textContent)))}}},yt=Y;var K=class extends c{constructor(t,e){super(t,["journal:scan"],e)}e(t){this.o({event:t,cells:[t.message.BodyName,t.message.ScanType]})}},wt=K;var J=class extends c{constructor(t,e){super(t,["commodity","outfitting","shipyard"],e)}e(t){let e=t.message;this.o({event:t,cells:[t.eventType==="commodity"?"Market":t.eventType==="shipyard"?"Shipyard":t.eventType==="outfitting"?"Outfitting":"",e.stationName,e.systemName]})}},bt=J;var Z=class extends c{constructor(t,e){super(t,["journal:fsdjump"],e)}e(t){let e=t.message;if(e.Population>0||e.SystemAllegiance){let s=e.SystemFaction??{};this.o({event:t,cells:[t.StarSystem,l.v.format(e.Population??0),e.SystemAllegiance,s.Name,s.FactionState]})}}},Et=Z;var xt={Approach:it,CodexEntry:ct,EventLog:lt,EventStats:ht,FSDJump:dt,GameStats:ut,Legend:M,Location:mt,NavRoute:ft,NewBodies:pt,NewStars:gt,Scan:wt,SoftwareStats:yt,Updates:bt,Visits:Et},$=class{#e;#s;#t;#o=new Map;#r=null;get ready(){return this.#r??=this.#n()}get container(){return this.#s}constructor(t,e={}){this.#e=t;let{container:s,infoBox:r}=e;if(s)this.#s=s;else{let o=document.createElement("div");o.className="dashboard",this.#s=o}r&&(this.#t=r),this.ready}fromContainer(){this.#a();let t=this.#s.querySelectorAll("div[data-dashboard__module]");for(let e of t){let s=e.dataset.dashboard__module,r={},o=xt[s];if(!o)throw new Error(`Dashboard: no class for module ${s}`);e.classList.add("dashboard__table"),e.replaceChildren(this.#i(s,o,r))}}fromArray(t){this.#a();let e=document.createDocumentFragment();for(let s of t){let r,o;typeof s=="string"?(r=s,o={}):{name:r,options:o={}}=s;let i=xt[r];if(!i)throw new Error(`Dashboard: no class for module ${r}`);let a=document.createElement("div");a.className="dashboard__table",a.append(this.#i(r,i,o)),e.append(a)}this.#s.append(e)}async#n(){try{let t=`templates.${encodeURIComponent(l.templateLocale)}.html`;console.debug(`Dashboard: loading templates from "${t}"...`);let e=await fetch(t);if(!e.ok)throw new Error(`HTTP ${e.status} ${e.statusText}`);let r=new DOMParser().parseFromString(await e.text(),"text/html").querySelectorAll("template[data-dashboard__module]");for(let o of r)this.#o.set(o.dataset.dashboard__module,o);console.debug(`Dashboard: loaded ${r.length} templates`)}catch(t){throw new Error("Dashboard: template load failed",{cause:t})}}#i(t,e,s){let r=this.#o.get(t);return r||console.warn(`Dashboard: no template for module "${t}"`),new e(this.#e,{template:r,...s}).n()}#a(){if(!this.#t){let t=this.#o.get("InfoBox");if(!t)throw new Error("Dashboard: no template for InfoBox");let e=new L(this.#s,t);this.#t=e,this.#s.addEventListener("click",s=>{let o=s.target.closest(".data")?.[c.DATA_KEY];o&&e.show(o)})}}};var O=class n extends EventTarget{static CONNECTING=WebSocket.CONNECTING;static OPEN=WebSocket.OPEN;static CLOSING=WebSocket.CLOSING;static CLOSED=WebSocket.CLOSED;maxReconnectAttempts=1/0;baseReconnectInterval=1200;maxReconnectInterval=3e4;reconnectDecay=1.3;jitterFactor=.3;connectionTimeout=4e3;#e;#s;#t=null;#o=0;#r=!1;#n=null;#i=null;#a="blob";#u=null;#h=null;#d=null;#m=null;#f;#p;constructor(t,e=[],s={}){super(),this.#e=t,this.#s=e;let{signal:r,...o}=s;Object.assign(this,o),r&&r.addEventListener("abort",()=>this.close(),{once:!0}),this.#f=()=>this.#b(),this.#p=()=>{},window.addEventListener("online",this.#f),window.addEventListener("offline",this.#p),this.#c()}get protocol(){return this.#t?.protocol||""}get readyState(){return this.#t?this.#t.readyState:this.#r?n.CLOSED:n.CONNECTING}get url(){return this.#e}get binaryType(){return this.#a}set binaryType(t){this.#a=t,this.#t&&(this.#t.binaryType=t)}set onopen(t){this.#l("open",t)}get onopen(){return this.#u}set onmessage(t){this.#l("message",t)}get onmessage(){return this.#h}set onclose(t){this.#l("close",t)}get onclose(){return this.#d}set onerror(t){this.#l("error",t)}get onerror(){return this.#m}#l(t,e){let s=`#on${t}`;this[s]&&this.removeEventListener(t,this[s]),this[s]=e,typeof e=="function"&&this.addEventListener(t,e)}send(t){if(this.#t&&this.#t.readyState===n.OPEN)this.#t.send(t);else throw new DOMException("WebSocket is not open. Wait for 'open' event.","InvalidStateError")}reconnect(){if(this.#r)throw new DOMException("Cannot reconnect a closed WebSocket.","InvalidStateError");this.#t&&(this.#g(this.#t),this.#t.close(1e3,"Manual Reconnect"),this.#t=null),this.#o=0,this.#c()}refresh(){this.reconnect()}close(t=1e3,e){this.#r=!0,this.#C(),this.#t&&(this.#g(this.#t),this.#t.close(t,e),this.#t=null),window.removeEventListener("online",this.#f),window.removeEventListener("offline",this.#p),this.dispatchEvent(new CloseEvent("close",{code:t,reason:e,wasClean:!0}))}#c(){if(!this.#r&&navigator.onLine&&!(this.#t&&this.#t.readyState===n.CONNECTING))try{let t=new WebSocket(this.#e,this.#s);this.#t=t,t.binaryType=this.#a,t.onopen=e=>this.#E(e),t.onclose=e=>this.#y(e),t.onmessage=e=>this.#x(e),t.onerror=e=>this.#S(e),this.#i=setTimeout(()=>{this.#t===t&&(this.#g(t),t.close(),this.#y({target:t,code:4008,reason:"Connection Timeout",wasClean:!1}))},this.connectionTimeout)}catch(t){if(t instanceof SyntaxError){this.close(1006,"Fatal Syntax Error"),this.dispatchEvent(new Event("error"));return}this.#w()}}#b(){this.#n?(clearTimeout(this.#n),this.#n=null,this.#o=0,this.#c()):(!this.#t||this.#t.readyState===n.CLOSED)&&(this.#o=0,this.#c())}#E(t){t.target===this.#t&&(clearTimeout(this.#i),this.#o=0,this.dispatchEvent(new Event("open")))}#x(t){t.target===this.#t&&this.dispatchEvent(new MessageEvent("message",{data:t.data,lastEventId:t.lastEventId,origin:t.origin,ports:t.ports,source:t.source}))}#y(t){t.target===this.#t&&(clearTimeout(this.#i),this.#t=null,this.dispatchEvent(new CloseEvent("close",{code:t.code,reason:t.reason,wasClean:t.wasClean})),this.#r||this.#w())}#S(t){t.target===this.#t&&this.dispatchEvent(new Event("error"))}#w(){if(this.#o>=this.maxReconnectAttempts){this.dispatchEvent(new Event("maxreconnects"));return}let t=this.baseReconnectInterval*Math.pow(this.reconnectDecay,this.#o);if(t=Math.min(t,this.maxReconnectInterval),this.jitterFactor>0){let e=t*this.jitterFactor,s=Math.random()*e*2-e;t=Math.max(0,t+s)}this.#n=setTimeout(()=>{this.#o++,this.#c()},t)}#C(){this.#n&&(clearTimeout(this.#n),this.#n=null),this.#i&&(clearTimeout(this.#i),this.#i=null)}#g(t){t&&(t.onopen=null,t.onclose=null,t.onmessage=null,t.onerror=null)}};var d=class n{static t=Object.freeze({f:Symbol("ok"),l:Symbol("off"),p:Symbol("idle"),g:Symbol("error")});#e;#s=null;#t=n.t.l;h;constructor(t,e=0){this.h=t,this.#e=e}d(t,e){}#o(t,e=0){this.#s&&(clearTimeout(this.#s),this.#s=null),this.#t!=t&&(this.d(t,this.#t),this.#t=t),e&&(this.#s=setTimeout(this.idle,e))}ok=()=>this.#o(n.t.f,this.#e);off=()=>this.#o(n.t.l,0);idle=()=>this.#o(n.t.p,0);error=()=>this.#o(n.t.g,0)},Q=class n extends d{static#e={[d.t.f]:"img/activity-icon/activity-icon--state-ok.svg",[d.t.l]:"img/activity-icon/activity-icon--state-off.svg",[d.t.p]:"img/activity-icon/activity-icon--state-idle.svg",[d.t.g]:"img/activity-icon/activity-icon--state-error.svg"};d(t,e){this.h.href=n.#e[t]}},x=class n extends Q{static#e=new Map;static#s=null;static get ready(){return this.#s??=this.#t()}constructor(t,e){super(t,e),this.ready}d(t,e){n.#e.has(t)?this.h.href=n.#e.get(t):(console.debug(`CachedPageIconActivity: no cache for ${t.toString()}`),super.d(t,e))}static async#t(){let t={[d.t.f]:"img/activity-icon/activity-icon--state-ok.svg",[d.t.l]:"img/activity-icon/activity-icon--state-off.svg",[d.t.p]:"img/activity-icon/activity-icon--state-idle.svg",[d.t.g]:"img/activity-icon/activity-icon--state-error.svg"};console.debug("CachedPageIconActivity: loading activity icons...");let e=Object.getOwnPropertySymbols(t).map(async s=>{let r=t[s];try{let o=await fetch(r);if(!o.ok)throw new Error(`HTTP ${o.status} ${o.statusText}`);this.#e.set(s,URL.createObjectURL(await o.blob())),console.debug(`CachedPageIconActivity: cached icon: ${r} for state: ${s.toString()}`)}catch(o){console.warn(`CachedPageIconActivity: failed to preload icon: ${r} for state: ${s.toString()}:`,o)}});return Promise.allSettled(e)}},St=class n extends d{static#e={[d.t.f]:"activity-icon--state-ok",[d.t.l]:"activity-icon--state-off",[d.t.p]:"activity-icon--state-idle",[d.t.g]:"activity-icon--state-error"};d(t,e){this.h.classList.add(n.#e[t]),this.h.classList.remove(n.#e[e])}};console.debug("Main: start");var f=new D({url:l.websocket_url,resetTimeout:l.resetTimeout,WebSocketClass:O,filter:l.globalEventFilter});f.addEventListener("eddn:error",n=>console.error(`EDDN error: ${n.message} - ${n.error}`));var S=new x(window.icon,l.idleTimeout);f.addEventListener("open",()=>S.idle());f.addEventListener("close",()=>S.off());f.addEventListener("error",()=>S.error());f.addEventListener("eddn:message",()=>S.ok());f.addEventListener("eddn:error",()=>S.error());var Ct=new $(new N(f),{container:document.querySelector(".dashboard")});document.readyState==="loading"&&await new Promise(n=>window.addEventListener("load",n,{once:!0}));await x.ready;await Ct.ready;console.debug("Main: load done");Ct.fromContainer();f.connect();console.debug("Main: init done");
//# sourceMappingURL=main.js.map
