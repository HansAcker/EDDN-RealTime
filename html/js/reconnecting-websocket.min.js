/*! https://github.com/joewalnes/reconnecting-websocket/ */
function l(e,t,n){var o,c={debug:!1,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:null,binaryType:"blob"};for(o in n=n||{},c)void 0!==n[o]?this[o]=n[o]:this[o]=c[o];this.url=e,this.reconnectAttempts=0,this.readyState=WebSocket.CONNECTING,this.protocol=null;var i,r=this,s=!1,a=!1,u=document.createElement("div");function d(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}u.addEventListener("open",function(e){r.onopen(e)}),u.addEventListener("close",function(e){r.onclose(e)}),u.addEventListener("connecting",function(e){r.onconnecting(e)}),u.addEventListener("message",function(e){r.onmessage(e)}),u.addEventListener("error",function(e){r.onerror(e)}),this.addEventListener=u.addEventListener.bind(u),this.removeEventListener=u.removeEventListener.bind(u),this.dispatchEvent=u.dispatchEvent.bind(u),this.open=function(n){if((i=new WebSocket(r.url,t||[])).binaryType=this.binaryType,n){if(this.maxReconnectAttempts&&this.reconnectAttempts>this.maxReconnectAttempts)return}else u.dispatchEvent(d("connecting")),this.reconnectAttempts=0;(r.debug||l.debugAll)&&console.debug("ReconnectingWebSocket","attempt-connect",r.url);var e=i,o=setTimeout(function(){(r.debug||l.debugAll)&&console.debug("ReconnectingWebSocket","connection-timeout",r.url),a=!0,e.close(),a=!1},r.timeoutInterval);i.onopen=function(e){clearTimeout(o),(r.debug||l.debugAll)&&console.debug("ReconnectingWebSocket","onopen",r.url),r.protocol=i.protocol,r.readyState=WebSocket.OPEN,r.reconnectAttempts=0;var t=d("open");t.isReconnect=n,n=!1,u.dispatchEvent(t)},i.onclose=function(e){var t;clearTimeout(void 0),i=null,s?(r.readyState=WebSocket.CLOSED,u.dispatchEvent(d("close"))):(r.readyState=WebSocket.CONNECTING,(t=d("connecting")).code=e.code,t.reason=e.reason,t.wasClean=e.wasClean,u.dispatchEvent(t),n||a||((r.debug||l.debugAll)&&console.debug("ReconnectingWebSocket","onclose",r.url),u.dispatchEvent(d("close"))),e=r.reconnectInterval*Math.pow(r.reconnectDecay,r.reconnectAttempts),setTimeout(function(){r.reconnectAttempts++,r.open(!0)},e>r.maxReconnectInterval?r.maxReconnectInterval:e))},i.onmessage=function(e){(r.debug||l.debugAll)&&console.debug("ReconnectingWebSocket","onmessage",r.url,e.data);var t=d("message");t.data=e.data,u.dispatchEvent(t)},i.onerror=function(e){(r.debug||l.debugAll)&&console.debug("ReconnectingWebSocket","onerror",r.url,e),u.dispatchEvent(d("error"))}},1==this.automaticOpen&&this.open(!1),this.send=function(e){if(i)return(r.debug||l.debugAll)&&console.debug("ReconnectingWebSocket","send",r.url,e),i.send(e);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},this.close=function(e,t){void 0===e&&(e=1e3),s=!0,i&&i.close(e,t)},this.refresh=function(){i&&i.close()}}l.prototype.onopen=function(e){},l.prototype.onclose=function(e){},l.prototype.onconnecting=function(e){},l.prototype.onmessage=function(e){},l.prototype.onerror=function(e){},l.debugAll=!1,l.CONNECTING=WebSocket.CONNECTING,l.OPEN=WebSocket.OPEN,l.CLOSING=WebSocket.CLOSING,l.CLOSED=WebSocket.CLOSED;export{l as ReconnectingWebSocket};
